---
name: 钉钉OAuth Authentication Implementation
status: open
created: 2025-09-22T07:13:13Z
updated: 2025-09-22T07:29:37Z
github: https://github.com/kongsiyu/prompt-sphere/issues/10
depends_on: [9]
parallel: true
conflicts_with: []
---

# Task: 钉钉OAuth Authentication Implementation

## Description
Implement 钉钉OAuth integration for user authentication, JWT token management, user session handling, and authorization middleware. This task provides secure authentication through DingTalk's OAuth system, enabling users to login with their corporate accounts and maintain secure sessions.

## Acceptance Criteria
- [ ] DingTalk OAuth 2.0 flow implementation (authorization code grant)
- [ ] User registration and login endpoints with DingTalk integration
- [ ] JWT token generation, validation, and refresh mechanisms
- [ ] Authentication middleware for protected routes
- [ ] User profile management with DingTalk user data sync
- [ ] Session management with Redis storage
- [ ] Role-based access control foundation
- [ ] Logout functionality with token invalidation
- [ ] Rate limiting for authentication endpoints
- [ ] Security headers and CSRF protection

## Technical Details
- Implement OAuth 2.0 authorization code flow with DingTalk APIs
- Use jsonwebtoken library for JWT handling with RS256 algorithm
- Store refresh tokens securely in Redis with expiration
- Create authentication middleware that validates JWT and attaches user context
- Implement user service for profile management and role assignment
- Use express-rate-limit for authentication endpoint protection
- Configure helmet.js for security headers
- Implement CSRF protection using csurf middleware
- Create user session management with automatic cleanup
- Handle DingTalk API errors gracefully with proper user feedback

## Dependencies
- [9] Backend API Server and Core Services Setup - Required for API server foundation

## Effort Estimate
- Size: M
- Hours: 20
- Parallel: true

## Definition of Done
- [ ] Code implemented
- [ ] Tests written and passing
- [ ] Documentation updated
- [ ] Code reviewed
